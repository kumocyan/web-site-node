<section class="section-block section-block--neutral">
  <div class="section-block__inner reveal">
    <div class="section-block__eyebrow">Inventory</div>
    <h1 class="section-block__heading"><%= title %></h1>
    <p class="section-block__description">価格帯や燃料種別で絞り込んで、安心・安全な一台を見つけてください。</p>

    <form class="inventory-filters" action="/inventory" method="GET">
      <div class="inventory-filters__grid">
        <label class="inventory-filters__field">
          <span>価格帯</span>
          <select name="price">
            <option value="">指定なし</option>
            <option value="50" <%= locals.query && query.price === '50' ? 'selected' : '' %>>〜50万円</option>
            <option value="100" <%= locals.query && query.price === '100' ? 'selected' : '' %>>50〜100万円</option>
            <option value="150" <%= locals.query && query.price === '150' ? 'selected' : '' %>>100〜150万円</option>
            <option value="200" <%= locals.query && query.price === '200' ? 'selected' : '' %>>150〜200万円</option>
            <option value="300" <%= locals.query && query.price === '300' ? 'selected' : '' %>>200〜300万円</option>
            <option value="301" <%= locals.query && query.price === '301' ? 'selected' : '' %>>300万円〜</option>
          </select>
        </label>
        <label class="inventory-filters__field">
          <span>燃料種別</span>
          <select name="fuel_type">
            <option value="">指定なし</option>
            <option value="ガソリン" <%= locals.query && query.fuel_type === 'ガソリン' ? 'selected' : '' %>>ガソリン</option>
            <option value="ハイブリッド" <%= locals.query && query.fuel_type === 'ハイブリッド' ? 'selected' : '' %>>ハイブリッド</option>
            <option value="電気" <%= locals.query && query.fuel_type === '電気' ? 'selected' : '' %>>電気</option>
            <option value="ディーゼル" <%= locals.query && query.fuel_type === 'ディーゼル' ? 'selected' : '' %>>ディーゼル</option>
          </select>
        </label>
        <label class="inventory-filters__field">
          <span>変速機</span>
          <select name="transmission">
            <option value="">指定なし</option>
            <option value="AT" <%= locals.query && query.transmission === 'AT' ? 'selected' : '' %>>AT</option>
            <option value="MT" <%= locals.query && query.transmission === 'MT' ? 'selected' : '' %>>MT</option>
            <option value="CVT" <%= locals.query && query.transmission === 'CVT' ? 'selected' : '' %>>CVT</option>
            <option value="DCT" <%= locals.query && query.transmission === 'DCT' ? 'selected' : '' %>>DCT</option>
          </select>
        </label>
        <label class="inventory-filters__field">
          <span>走行距離</span>
          <select name="mileage">
            <option value="">指定なし</option>
            <option value="1" <%= locals.query && query.mileage === '1' ? 'selected' : '' %>>1万km以内</option>
            <option value="3" <%= locals.query && query.mileage === '3' ? 'selected' : '' %>>3万km以内</option>
            <option value="5" <%= locals.query && query.mileage === '5' ? 'selected' : '' %>>5万km以内</option>
            <option value="10" <%= locals.query && query.mileage === '10' ? 'selected' : '' %>>10万km以内</option>
          </select>
        </label>
      </div>
      <div class="inventory-filters__actions">
        <button type="submit" class="button button--primary"><i class="fas fa-search"></i> 絞り込む</button>
        <a href="/inventory" class="button button--outline">条件クリア</a>
      </div>
    </form>

    <% if (cars && cars.length > 0) { %>
      <p class="inventory-result-count" style="margin: 2rem 0 1rem 0; font-size: 1.05rem; color: var(--color-ink-300);">検索結果: <strong style="color: var(--color-ink-400);"><%= cars.length %></strong>台</p>
    <% } else if (cars && cars.length === 0 && (query.price || query.fuel_type || query.transmission || query.mileage)) { %>
      <div class="empty-state" style="margin: 3rem 0;">
        <i class="fas fa-search fa-2x"></i>
        <p style="margin-top: 1rem;">条件に合う車両が見つかりませんでした。<br>条件を変更してお探しください。</p>
      </div>
    <% } %>

    <div class="inventory-grid">
      <% if (cars && cars.length > 0) { %>
        <% cars.forEach(car => {
             const priceMan = Math.round((Number(car.price) || 0) / 10000);
        %>
          <article class="inventory-card">
            <div class="inventory-card__image">
              <% if (car.image_path) { %>
                <img src="<%= car.image_path.startsWith('/assets/') ? car.image_path : '/assets/car-stock/' + car.image_path %>" alt="<%= car.name %>">
              <% } else { %>
                <div class="inventory-card__placeholder"><i class="fas fa-camera"></i></div>
              <% } %>
              <span class="inventory-card__badge"><%= car.status === 'available' ? 'Available' : car.status === 'reserved' ? 'Reserved' : 'Sold' %></span>
            </div>
            <div class="inventory-card__body">
              <h2 class="inventory-card__title"><%= car.name %></h2>
              <p class="inventory-card__subtitle"><%= car.model || '' %></p>
              <div class="inventory-card__meta">
                <span><i class="fas fa-calendar"></i><%= car.year %>年式</span>
                <span><i class="fas fa-tachometer-alt"></i><%= (car.mileage / 1000).toFixed(1) %>千km</span>
                <span><i class="fas fa-yen-sign"></i><%= priceMan.toLocaleString('ja-JP') %>万円</span>
              </div>
              <div class="inventory-card__tags">
                <span><%= car.color %></span>
                <span><%= car.fuel_type %></span>
                <span><%= car.transmission %></span>
              </div>
              <a class="inventory-card__cta" href="/inventory/<%= car.id %>">詳細を見る <i class="fas fa-arrow-right"></i></a>
            </div>
          </article>
        <% }) %>
      <% } else if (!query.price && !query.fuel_type && !query.transmission && !query.mileage) { %>
        <div class="empty-state">
          <i class="fas fa-hourglass-half fa-2x"></i>
          <p>現在、新着車両は準備中です。</p>
        </div>
      <% } %>
    </div>
  </div>
</section>
