<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">ホーム</a></li>
          <li class="breadcrumb-item active" aria-current="page">管理画面</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><%= title %></h1>
        <a href="/admin/new" class="btn btn-success">
          <i class="fas fa-plus me-2"></i>新規車両追加
        </a>
      </div>

          <!-- 在庫統計 -->
          <div class="row mb-4 g-3">
            <div class="col-md-3">
              <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body d-flex flex-column justify-content-center">
                  <div class="display-4 fw-bold text-success mb-2">
                    <i class="fas fa-check-circle me-2"></i><%= cars.filter(c => c.status === 'available').length %>
                  </div>
                  <div class="text-muted">在庫あり</div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-success" style="width: <%= (cars.filter(c => c.status === 'available').length / cars.length * 100) %>%"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body d-flex flex-column justify-content-center">
                  <div class="display-4 fw-bold text-warning mb-2">
                    <i class="fas fa-clock me-2"></i><%= cars.filter(c => c.status === 'reserved').length %>
                  </div>
                  <div class="text-muted">予約中</div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-warning" style="width: <%= (cars.filter(c => c.status === 'reserved').length / cars.length * 100) %>%"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body d-flex flex-column justify-content-center">
                  <div class="display-4 fw-bold text-secondary mb-2">
                    <i class="fas fa-times-circle me-2"></i><%= cars.filter(c => c.status === 'sold').length %>
                  </div>
                  <div class="text-muted">売約済み</div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-secondary" style="width: <%= (cars.filter(c => c.status === 'sold').length / cars.length * 100) %>%"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card border-0 shadow-sm text-center h-100" style="background: linear-gradient(135deg, var(--nstyle-primary), var(--nstyle-secondary)); color: white;">
                <div class="card-body d-flex flex-column justify-content-center">
                  <div class="display-4 fw-bold mb-2">
                    <i class="fas fa-car me-2"></i><%= cars.length %>
                  </div>
                  <div class="opacity-75">総車両数</div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-white opacity-75" style="width: 100%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 在庫テーブル -->
          <div class="card border-0 shadow-lg">
            <div class="card-header" style="background: linear-gradient(135deg, var(--nstyle-primary), var(--nstyle-secondary)); color: white;">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>車両一覧
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive admin-car-list">
                <table class="table table-hover mb-0">
                  <thead style="background-color: var(--nstyle-light);">
                    <tr>
                      <th class="py-3 ps-4 fw-bold text-muted">
                        <i class="fas fa-image me-2"></i>画像
                      </th>
                      <th class="py-3 fw-bold text-muted d-none d-md-table-cell">
                        <i class="fas fa-car me-2"></i>車両名
                      </th>
                      <th class="py-3 fw-bold text-muted d-none d-md-table-cell">
                        <i class="fas fa-calendar me-2"></i>年式
                      </th>
                      <th class="py-3 fw-bold text-muted d-none d-md-table-cell">
                        <i class="fas fa-tachometer-alt me-2"></i>走行距離
                      </th>
                      <th class="py-3 fw-bold text-muted">
                        <i class="fas fa-yen-sign me-2"></i>価格
                      </th>
                      <th class="py-3 fw-bold text-muted d-none d-md-table-cell">
                        <i class="fas fa-info-circle me-2"></i>在庫状況
                      </th>
                      <th class="py-3 fw-bold text-muted d-none d-md-table-cell">
                        <i class="fas fa-clock me-2"></i>登録日
                      </th>
                      <th class="py-3 pe-4 fw-bold text-muted">
                        <i class="fas fa-cogs me-2"></i>操作
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (cars && cars.length > 0) { %>
                      <% cars.forEach(car => { %>
                        <tr class="animate-fade-in">
                          <td class="ps-4 py-3">
                            <% if (car.image_path) { %>
                              <img src="<%= car.image_path %>" alt="<%= car.name %>"
                                   class="rounded shadow-sm"
                                   style="width: 60px; height: 45px; object-fit: cover;">
                            <% } else { %>
                              <div class="bg-light rounded d-flex align-items-center justify-content-center shadow-sm"
                                   style="width: 60px; height: 45px;">
                                <i class="fas fa-car text-muted"></i>
                              </div>
                            <% } %>
                          </td>
                          <td class="py-3 d-none d-md-table-cell">
                            <strong class="text-dark"><%= car.name %></strong>
                            <% if (car.model) { %>
                              <br><small class="text-muted"><%= car.model %></small>
                            <% } %>
                          </td>
                          <td class="py-3 fw-bold text-primary d-none d-md-table-cell"><%= car.year %>年</td>
                          <td class="py-3 fw-bold text-success d-none d-md-table-cell"><%= car.mileage.toLocaleString() %>km</td>
                          <td class="py-3 fw-bold text-danger"><%= (Number(car.price) / 10000).toLocaleString('ja-JP', { minimumFractionDigits: 0, maximumFractionDigits: Number(car.price) % 10000 === 0 ? 0 : 1 }) %>万</td>
                          <td class="py-3 d-none d-md-table-cell">
                            <% if (car.status === 'available') { %>
                              <span class="nstyle-badge">
                                <i class="fas fa-check me-1"></i>在庫あり
                              </span>
                            <% } else if (car.status === 'reserved') { %>
                              <span class="badge bg-warning">
                                <i class="fas fa-clock me-1"></i>予約中
                              </span>
                            <% } else { %>
                              <span class="badge bg-secondary">
                                <i class="fas fa-times me-1"></i>売約済み
                              </span>
                            <% } %>
                          </td>
                          <td class="py-3 text-muted small d-none d-md-table-cell">
                            <%= new Date(car.created_at).toLocaleDateString('ja-JP') %>
                          </td>
                          <td class="py-3 pe-4">
                            <form action="/admin/<%= car.id %>?_method=DELETE" method="POST" class="btn-group btn-group-sm" onsubmit="return confirm('本当に削除しますか？');" style="gap: 0.25rem;">
                              <a href="/inventory/<%= car.id %>" class="btn btn-outline-primary" target="_blank" title="詳細表示">
                                <i class="fas fa-eye"></i>
                              </a>
                              <a href="/admin/<%= car.id %>/edit" class="btn btn-outline-secondary" title="編集">
                                <i class="fas fa-edit"></i>
                              </a>
                              <button type="submit" class="btn btn-outline-danger" title="削除">
                                <i class="fas fa-trash"></i>
                              </button>
                            </form>
                          </td>
                        </tr>
                      <% }); %>
                    <% } else { %>
                      <tr>
                        <td colspan="8" class="text-center py-5">
                          <div class="text-muted">
                            <i class="fas fa-car fa-3x mb-3 opacity-50"></i>
                            <h5 class="mb-2">車両データがありません</h5>
                            <p class="mb-0">新しい車両を追加してください</p>
                          </div>
                        </td>
                      </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/script.js"></script>
</body>
</html>
